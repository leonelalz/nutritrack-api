# ğŸ“‹ USER STORIES - NUTRITRACK

> **Documento Fundacional del Proyecto**  
> Este documento establece las 25 User Stories que definen la funcionalidad del sistema NutriTrack.  
> Cada historia describe QUÃ‰ debe hacer el sistema desde la perspectiva del usuario.

---

## ğŸ“Š ORGANIZACIÃ“N POR MÃ“DULOS

### DistribuciÃ³n de User Stories

| MÃ³dulo | User Stories | Total | DescripciÃ³n |
|--------|--------------|-------|-------------|
| **MÃ³dulo 1** | US-01 a US-05 | 5 historias | GestiÃ³n de Cuentas y Perfil |
| **MÃ³dulo 2** | US-06 a US-10 | 5 historias | Biblioteca de Contenido (Admin) |
| **MÃ³dulo 3** | US-11 a US-15 | 5 historias | Gestor de CatÃ¡logo - Planes y Rutinas (Admin) |
| **MÃ³dulo 4** | US-16 a US-20 | 5 historias | ExploraciÃ³n y ActivaciÃ³n (Cliente) |
| **MÃ³dulo 5** | US-21 a US-25 | 5 historias | Seguimiento de Progreso (Cliente) |
| **TOTAL** | | **25 historias** | Funcionalidad completa del sistema |

---

## ğŸ“‹ MÃ“DULO 1: GESTIÃ“N DE CUENTAS Y PERFIL

### US-01 - Crear Cuenta
**Como** usuario nuevo  
**Quiero** registrarme en el sistema  
**Para** acceder a las funcionalidades de NutriTrack

**Criterios de AceptaciÃ³n:**
- Usuario proporciona: email, contraseÃ±a, nombre completo
- Email debe ser Ãºnico en el sistema
- ContraseÃ±a debe cumplir requisitos de seguridad (min 8 caracteres)
- Sistema crea `cuentas_auth` y `perfiles_usuario` automÃ¡ticamente
- Usuario recibe confirmaciÃ³n exitosa

**Endpoint:** `POST /api/v1/auth/registro`  
**Relacionado con:** RN01 (Email Ãºnico), RN02 (ValidaciÃ³n credenciales)

---

### US-02 - Iniciar SesiÃ³n
**Como** usuario registrado  
**Quiero** autenticarme en el sistema  
**Para** acceder a mi cuenta personal

**Criterios de AceptaciÃ³n:**
- Usuario proporciona email y contraseÃ±a
- Sistema valida credenciales contra `cuentas_auth`
- Cuenta debe estar activa (`activo = true`)
- Sistema genera y retorna JWT token
- Token tiene validez de 24 horas

**Endpoint:** `POST /api/v1/auth/login`  
**Relacionado con:** RN02 (Login falla si inactivo)

---

### US-03 - Configurar Unidades de Medida
**Como** usuario  
**Quiero** seleccionar mi preferencia de unidades (KG/LBS)  
**Para** ver los datos en mi sistema de medida preferido

**Criterios de AceptaciÃ³n:**
- Usuario puede elegir entre KG o LBS
- Preferencia se guarda en `perfiles_usuario.unidades_medida`
- Todos los pesos mostrados se convierten a la unidad seleccionada
- Base de datos siempre almacena en KG (conversiÃ³n en presentaciÃ³n)

**Endpoint:** `PATCH /api/v1/perfil/unidades`  
**Relacionado con:** RN03 (Unidad aplica a todas las vistas), RN27 (Consistencia)

---

### US-04 - Editar Perfil de Salud
**Como** usuario  
**Quiero** configurar mi perfil de salud (objetivos, alergias, condiciones)  
**Para** recibir planes personalizados y seguros

**Criterios de AceptaciÃ³n:**
- Usuario selecciona objetivos de lista de etiquetas maestras
- Usuario selecciona alergias alimentarias (etiquetas tipo "alergia")
- Usuario selecciona condiciones mÃ©dicas (etiquetas tipo "condicion")
- Sistema guarda en `usuario_perfil_salud` y `usuario_etiquetas_salud`
- Solo se permiten etiquetas existentes en tabla `etiquetas`

**Endpoint:** `PUT /api/v1/perfil/salud`  
**Relacionado con:** RN04 (Etiquetas maestras), RN16 (Filtrado por alergias)

---

### US-05 - Eliminar Cuenta
**Como** usuario  
**Quiero** eliminar permanentemente mi cuenta  
**Para** retirarme del sistema

**Criterios de AceptaciÃ³n:**
- Sistema solicita confirmaciÃ³n explÃ­cita (escribir "ELIMINAR")
- Usuario debe estar autenticado
- Sistema elimina `cuentas_auth` con CASCADE a todas las tablas relacionadas
- Datos se eliminan permanentemente (no soft delete para cuentas)
- Sistema retorna confirmaciÃ³n de eliminaciÃ³n

**Endpoint:** `DELETE /api/v1/auth/cuenta`  
**Relacionado con:** RN05 (ConfirmaciÃ³n explÃ­cita)

## ğŸ“š MÃ“DULO 2: BIBLIOTECA DE CONTENIDO (ADMIN)

### US-06 - Gestionar Etiquetas
**Como** administrador  
**Quiero** crear, editar y eliminar etiquetas maestras  
**Para** categorizar ingredientes, ejercicios y planes

**Criterios de AceptaciÃ³n:**
- Admin puede crear etiquetas con nombre Ãºnico
- Admin puede asignar tipo: objetivo, alergia, condicion, categoria
- Admin NO puede eliminar etiqueta si estÃ¡ en uso
- Sistema lista todas las etiquetas activas

**Endpoints:** `POST/GET/PUT/DELETE /api/v1/admin/etiquetas`  
**Relacionado con:** RN06 (Nombre Ãºnico), RN08 (No eliminar si en uso)

---

### US-07 - Gestionar Ingredientes
**Como** administrador  
**Quiero** crear y mantener catÃ¡logo de ingredientes  
**Para** que estÃ©n disponibles al crear comidas

**Criterios de AceptaciÃ³n:**
- Admin crea ingrediente con: nombre, calorÃ­as, proteÃ­nas, carbohidratos, grasas (por 100g)
- Admin puede asignar etiquetas al ingrediente (ej: "Nueces", "LÃ¡cteos")
- Nombre debe ser Ãºnico
- Admin NO puede eliminar ingrediente si estÃ¡ en recetas activas

**Endpoints:** `POST/GET/PUT/DELETE /api/v1/admin/ingredientes`  
**Relacionado con:** RN07 (Nombre Ãºnico), RN09 (No eliminar si en uso)

---

### US-08 - Gestionar Ejercicios
**Como** administrador  
**Quiero** crear y mantener catÃ¡logo de ejercicios  
**Para** que estÃ©n disponibles al crear rutinas

**Criterios de AceptaciÃ³n:**
- Admin crea ejercicio con: nombre, descripciÃ³n, grupo muscular, nivel dificultad
- Admin puede asignar etiquetas (ej: "Cardio", "Fuerza")
- Nombre debe ser Ãºnico
- Admin NO puede eliminar ejercicio si estÃ¡ en rutinas activas

**Endpoints:** `POST/GET/PUT/DELETE /api/v1/admin/ejercicios`  
**Relacionado con:** RN07 (Nombre Ãºnico), RN09 (No eliminar si en uso)

---

### US-09 - Gestionar Comidas
**Como** administrador  
**Quiero** crear comidas (platos/recetas) combinando ingredientes  
**Para** incluirlas en planes nutricionales

**Criterios de AceptaciÃ³n:**
- Admin crea comida con nombre y descripciÃ³n
- Admin debe agregar AL MENOS 1 ingrediente (US-10)
- Sistema calcula calorÃ­as totales automÃ¡ticamente
- Admin puede asignar etiquetas a la comida

**Endpoints:** `POST/GET/PUT/DELETE /api/v1/admin/comidas`  
**Relacionado con:** US-10, RN25 (CÃ¡lculo automÃ¡tico)

---

### US-10 - Gestionar Recetas (Ingredientes de Comida)
**Como** administrador  
**Quiero** agregar ingredientes a una comida con cantidades especÃ­ficas  
**Para** definir la composiciÃ³n nutricional

**Criterios de AceptaciÃ³n:**
- Admin selecciona ingrediente existente
- Admin especifica cantidad en gramos (valor positivo)
- Sistema calcula calorÃ­as: `(ingrediente.calorias * cantidad) / 100`
- Admin puede modificar o eliminar ingredientes de la receta

**Endpoints:** `POST/DELETE /api/v1/admin/comidas/{id}/ingredientes`  
**Relacionado con:** RN10 (Cantidad positiva), RN25 (CÃ¡lculo automÃ¡tico)

---

## ğŸ—‚ï¸ MÃ“DULO 3: GESTOR DE CATÃLOGO - PLANES Y RUTINAS (ADMIN)

**Nota Importante:** En la implementaciÃ³n, el concepto "catalogo_metas" se divide en dos entidades separadas:
- **Planes Nutricionales** (tabla `planes`)
- **Rutinas de Ejercicio** (tabla `rutinas`)

Esta separaciÃ³n mejora la arquitectura permitiendo gestiÃ³n independiente de nutriciÃ³n y ejercicio.

---

### US-11 - Crear Meta del CatÃ¡logo (Plan o Rutina)
**Como** administrador  
**Quiero** crear un plan nutricional o rutina de ejercicio  
**Para** ofrecerlos en el catÃ¡logo a los usuarios

**Criterios de AceptaciÃ³n - Plan Nutricional:**
- Admin crea plan con: nombre, descripciÃ³n, duraciÃ³n (dÃ­as), objetivo calorÃ­as diarias
- Nombre debe ser Ãºnico
- Admin puede asignar etiquetas (ej: "PÃ©rdida de peso", "Vegano")
- Plan se guarda en tabla `planes`

**Criterios de AceptaciÃ³n - Rutina Ejercicio:**
- Admin crea rutina con: nombre, descripciÃ³n, duraciÃ³n (semanas), nivel dificultad
- Nombre debe ser Ãºnico
- Admin puede asignar etiquetas (ej: "Principiante", "Cardio")
- Rutina se guarda en tabla `rutinas`

**Endpoints:** `POST /api/v1/admin/planes`, `POST /api/v1/admin/rutinas`  
**Relacionado con:** RN11 (Nombres Ãºnicos)

---

### US-12 - Gestionar Meta (Asignar Etiquetas y Actividades)
**Como** administrador  
**Quiero** configurar los dÃ­as/actividades de un plan o rutina  
**Para** definir quÃ© harÃ¡ el usuario cada dÃ­a

**Criterios de AceptaciÃ³n - Plan:**
- Admin asigna comidas a dÃ­as especÃ­ficos (tabla `plan_dias`)
- Cada dÃ­a puede tener: desayuno, almuerzo, cena, snacks
- Admin especifica porciones recomendadas

**Criterios de AceptaciÃ³n - Rutina:**
- Admin asigna ejercicios a la rutina (tabla `rutina_ejercicios`)
- Admin especifica series, repeticiones, tiempo descanso
- Admin define dÃ­a de semana para cada ejercicio

**Endpoints:** `POST /api/v1/admin/planes/{id}/dias`, `POST /api/v1/admin/rutinas/{id}/ejercicios`  
**Relacionado con:** RN12 (Solo etiquetas existentes), RN13 (Series positivas)

---

### US-13 - Ver CatÃ¡logo de Metas (Admin)
**Como** administrador  
**Quiero** ver listado completo de planes y rutinas  
**Para** gestionarlos y verificar el catÃ¡logo

**Criterios de AceptaciÃ³n:**
- Admin ve TODOS los planes (activos e inactivos)
- Admin ve TODAS las rutinas (activas e inactivas)
- Listado incluye: nombre, duraciÃ³n, etiquetas, estado (activo/inactivo)
- Admin puede filtrar por etiquetas

**Endpoints:** `GET /api/v1/admin/planes`, `GET /api/v1/admin/rutinas`  
**Relacionado con:** US-16 (CatÃ¡logo cliente)

---

### US-14 - Eliminar Meta
**Como** administrador  
**Quiero** eliminar un plan o rutina del catÃ¡logo  
**Para** mantener solo contenido relevante

**Criterios de AceptaciÃ³n:**
- Sistema usa SOFT DELETE (marca como inactivo)
- Admin NO puede eliminar si hay usuarios con asignaciÃ³n ACTIVA
- Sistema retorna error si plan/rutina estÃ¡ en uso
- Planes/rutinas inactivos no aparecen en catÃ¡logo de clientes

**Endpoints:** `DELETE /api/v1/admin/planes/{id}`, `DELETE /api/v1/admin/rutinas/{id}`  
**Relacionado con:** RN14 (No eliminar si usuarios activos), RN28 (Soft delete)

---

### US-15 - Ensamblar Rutinas
**Como** administrador  
**Quiero** configurar ejercicios dentro de una rutina con parÃ¡metros especÃ­ficos  
**Para** definir el entrenamiento completo

**Criterios de AceptaciÃ³n:**
- Admin agrega ejercicio existente a rutina
- Admin especifica: series (entero positivo), repeticiones (entero positivo), peso sugerido, dÃ­a de semana
- Valores deben ser nÃºmericos y positivos
- Admin puede reordenar ejercicios en la rutina

**Endpoints:** `POST /api/v1/admin/rutinas/{id}/ejercicios`  
**Relacionado con:** RN13 (Series y reps positivas)

---

## ğŸ” MÃ“DULO 4: EXPLORACIÃ“N Y ACTIVACIÃ“N (CLIENTE)

### US-16 - Ver CatÃ¡logo (Cliente)
**Como** usuario cliente  
**Quiero** explorar el catÃ¡logo de planes y rutinas disponibles  
**Para** encontrar uno que se ajuste a mis necesidades

**Criterios de AceptaciÃ³n:**
- Usuario ve solo planes/rutinas ACTIVOS
- Si usuario tiene perfil de salud configurado, ver planes sugeridos segÃºn objetivo
- Sistema OCULTA planes que contengan ingredientes a los que usuario es alÃ©rgico
- Usuario puede filtrar por etiquetas (ej: "Vegano", "Principiante")
- Listado muestra: nombre, descripciÃ³n, duraciÃ³n, etiquetas

**Endpoints:** `GET /api/v1/planes/catalogo`, `GET /api/v1/rutinas/catalogo`  
**Relacionado con:** RN15 (Sugerencias segÃºn perfil), RN16 (Â¡CRÃTICO! Filtrar alÃ©rgenos)

---

### US-17 - Ver Detalle de Meta
**Como** usuario cliente  
**Quiero** ver los detalles completos de un plan o rutina  
**Para** decidir si activarlo

**Criterios de AceptaciÃ³n - Plan:**
- Usuario ve: nombre, descripciÃ³n, duraciÃ³n, objetivo calorÃ­as, etiquetas
- Usuario ve comidas programadas por dÃ­a (desayuno, almuerzo, cena)
- Usuario ve informaciÃ³n nutricional total

**Criterios de AceptaciÃ³n - Rutina:**
- Usuario ve: nombre, descripciÃ³n, duraciÃ³n, nivel dificultad, etiquetas
- Usuario ve ejercicios con series, repeticiones, dÃ­a de semana
- Usuario ve grupos musculares trabajados

**Endpoints:** `GET /api/v1/planes/{id}`, `GET /api/v1/rutinas/{id}`  
**Relacionado con:** US-18 (Activar meta)

---

### US-18 - Activar una Meta
**Como** usuario cliente  
**Quiero** activar un plan nutricional o rutina de ejercicio  
**Para** comenzar a seguirlo

**Criterios de AceptaciÃ³n:**
- Usuario puede activar plan o rutina desde el detalle
- Sistema verifica que usuario NO tiene otro plan/rutina ACTIVO del mismo tipo
- Si ya tiene uno activo, sistema propone reemplazarlo
- Al activar, sistema crea registro en `usuarios_planes` o `usuarios_rutinas` con estado ACTIVO
- Sistema registra fecha inicio y calcula fecha fin estimada

**Endpoints:** `POST /api/v1/usuario/planes/{id}/activar`, `POST /api/v1/usuario/rutinas/{id}/activar`  
**Relacionado con:** RN17 (Solo una activa), RN18 (Proponer reemplazo)

---

### US-19 - Pausar/Reanudar Meta
**Como** usuario cliente  
**Quiero** pausar temporalmente mi plan o rutina  
**Para** retomarlo despuÃ©s sin perder progreso

**Criterios de AceptaciÃ³n:**
- Usuario puede pausar plan/rutina con estado ACTIVO
- Usuario puede reanudar plan/rutina con estado PAUSADO
- Usuario NO puede pausar si estado es COMPLETADO o CANCELADO
- Al pausar, sistema marca fecha de pausa
- Al reanudar, sistema extiende fecha fin considerando dÃ­as pausados

**Endpoints:** `PATCH /api/v1/usuario/planes/{id}/pausar`, `PATCH /api/v1/usuario/planes/{id}/reanudar`  
**Relacionado con:** RN19 (No pausar si completado), RN26 (Transiciones vÃ¡lidas)

---

### US-20 - Completar/Cancelar Meta
**Como** usuario cliente  
**Quiero** marcar mi plan/rutina como completado o cancelarlo  
**Para** finalizar el seguimiento

**Criterios de AceptaciÃ³n:**
- Sistema marca automÃ¡ticamente como COMPLETADO al llegar a duraciÃ³n total
- Usuario puede marcar manualmente como COMPLETADO antes de tiempo
- Usuario puede CANCELAR plan/rutina en cualquier momento
- Estados finales (COMPLETADO/CANCELADO) no permiten mÃ¡s cambios
- Sistema registra fecha de finalizaciÃ³n y motivo (completado/cancelado)

**Endpoints:** `PATCH /api/v1/usuario/planes/{id}/completar`, `PATCH /api/v1/usuario/planes/{id}/cancelar`  
**Relacionado con:** RN26 (Transiciones vÃ¡lidas)

---

## ğŸ“Š MÃ“DULO 5: SEGUIMIENTO DE PROGRESO (CLIENTE)

### US-21 - Ver Actividades de mi Plan
**Como** usuario cliente  
**Quiero** ver las actividades programadas para hoy  
**Para** saber quÃ© comidas/ejercicios debo completar

**Criterios de AceptaciÃ³n - Plan Nutricional:**
- Usuario ve comidas del dÃ­a actual de su plan activo
- Sistema calcula: `dia_actual = fecha_hoy - fecha_inicio + 1`
- Usuario ve si ya registrÃ³ cada comida (marca visual âœ“)
- Usuario ve calorÃ­as objetivo vs calorÃ­as consumidas

**Criterios de AceptaciÃ³n - Rutina:**
- Usuario ve ejercicios programados para hoy
- Usuario ve si ya registrÃ³ cada ejercicio (marca visual âœ“)
- Usuario ve series/reps completadas vs objetivo

**Endpoints:** `GET /api/v1/usuario/plan-actual/hoy`, `GET /api/v1/usuario/rutina-actual/hoy`  
**Relacionado con:** RN20 (Mostrar checks), US-22 (Marcar actividad)

---

### US-22 - Marcar Actividad como Completada
**Como** usuario cliente  
**Quiero** registrar que completÃ© una comida o ejercicio  
**Para** llevar seguimiento de mi progreso

**Criterios de AceptaciÃ³n - Comida:**
- Usuario registra comida con: fecha, comida_id, porciones consumidas
- Sistema calcula calorÃ­as consumidas automÃ¡ticamente
- Sistema NO permite registrar si plan estÃ¡ PAUSADO
- Registro se guarda en `registros_comidas`

**Criterios de AceptaciÃ³n - Ejercicio:**
- Usuario registra ejercicio con: fecha, ejercicio_id, series, reps, peso usado
- Sistema NO permite registrar si rutina estÃ¡ PAUSADA
- Registro se guarda en `registros_ejercicios`

**Endpoints:** `POST /api/v1/usuario/registros/comidas`, `POST /api/v1/usuario/registros/ejercicios`  
**Relacionado con:** RN21 (No marcar si pausado), RN25 (CÃ¡lculo automÃ¡tico)

---

### US-23 - Desmarcar Actividad
**Como** usuario cliente  
**Quiero** eliminar un registro de actividad que marquÃ© por error  
**Para** corregir mi seguimiento

**Criterios de AceptaciÃ³n:**
- Usuario puede eliminar registro de comida del dÃ­a actual
- Usuario puede eliminar registro de ejercicio del dÃ­a actual
- Sistema recalcula calorÃ­as totales del dÃ­a
- Solo se pueden eliminar registros propios

**Endpoints:** `DELETE /api/v1/usuario/registros/comidas/{id}`, `DELETE /api/v1/usuario/registros/ejercicios/{id}`  
**Relacionado con:** US-22 (Marcar actividad)

---

### US-24 - Registrar y Ver Mediciones
**Como** usuario cliente  
**Quiero** registrar mis mediciones corporales periÃ³dicamente  
**Para** monitorear mi progreso fÃ­sico

**Criterios de AceptaciÃ³n:**
- Usuario registra: peso, altura, circunferencia cintura (opcional), fecha
- Valores deben ser numÃ©ricos y dentro de rangos realistas (ej: peso 20-600 kg)
- Sistema guarda en `usuario_historial_medidas`
- Usuario puede ver historial completo de mediciones
- Sistema convierte unidades segÃºn preferencia del usuario

**Endpoints:** `POST /api/v1/usuario/mediciones`, `GET /api/v1/usuario/mediciones`  
**Relacionado con:** RN22 (Validar rangos), RN27 (Unidades consistentes)

---

### US-25 - Ver GrÃ¡fico de Progreso y Reporte
**Como** usuario cliente  
**Quiero** ver un grÃ¡fico de mi evoluciÃ³n de peso y exportar reporte  
**Para** visualizar mi progreso en el tiempo

**Criterios de AceptaciÃ³n:**
- Sistema genera grÃ¡fico de peso vs tiempo (requiere mÃ­nimo 2 mediciones)
- Usuario puede exportar reporte en PDF con:
  - Datos personales
  - GrÃ¡fico de peso
  - Resumen de actividades completadas
  - Adherencia a plan/rutina
- PDF debe tener formato estÃ¡ndar y mÃ¡ximo 5 MB

**Endpoints:** `GET /api/v1/usuario/progreso/grafico`, `GET /api/v1/usuario/progreso/pdf`  
**Relacionado con:** RN23 (MÃ­nimo 2 registros), RN24 (GeneraciÃ³n PDF)
---

**Fecha de CreaciÃ³n:** 4 de Noviembre, 2025  
**VersiÃ³n del Documento:** 1.0  
**PropÃ³sito:** Documento fundacional - Define las 25 User Stories del sistema

---

> **ğŸ’¡ Nota sobre Arquitectura:**  
> Las User Stories US-11 a US-20 mencionan "catalogo_metas" como concepto unificado.  
> En la implementaciÃ³n, esto se divide en **Planes Nutricionales** y **Rutinas de Ejercicio** como entidades separadas.  
> Esta separaciÃ³n mejora la arquitectura permitiendo gestiÃ³n especializada de nutriciÃ³n y entrenamiento.
