{
	"info": {
		"_postman_id": "nutritrack-modulo1-v1",
		"name": "NutriTrack API - Módulo 1",
		"description": "Colección de pruebas para Módulo 1: Autenticación y Gestión de Perfiles\n\n**Funcionalidades implementadas:**\n- Registro de usuarios\n- Inicio de sesión\n- Eliminación de cuenta\n- Gestión de perfil de usuario\n- Configuración de perfil de salud\n- Actualización de unidades de medida\n- Registro de historial de medidas\n\n**Variables automáticas:**\n- `adminToken` - Token del usuario admin (admin@nutritrack.com)\n- `userToken` - Token del usuario regular\n- `userId` - ID del usuario autenticado\n\n**Credenciales iniciales:**\n- Admin: admin@nutritrack.com / Admin123!\n\n**Base URL:** http://localhost:8081",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "nutritrack-modulo1"
	},
	"auth": {
		"type": "bearer",
		"bearer": [
			{
				"key": "token",
				"value": "{{userToken}}",
				"type": "string"
			}
		]
	},
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:8081",
			"type": "string"
		},
		{
			"key": "adminToken",
			"value": "",
			"type": "string"
		},
		{
			"key": "userToken",
			"value": "",
			"type": "string"
		},
		{
			"key": "userId",
			"value": "",
			"type": "string"
		}
	],
	"item": [
		{
			"name": "1. Autenticación",
			"description": "Endpoints públicos para registro y login",
			"item": [
				{
					"name": "Login Admin",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    var jsonData = pm.response.json();",
									"    if (jsonData.data && jsonData.data.token) {",
									"        pm.collectionVariables.set('adminToken', jsonData.data.token);",
									"        console.log('✅ Admin token guardado:', jsonData.data.token);",
									"    }",
									"} else {",
									"    console.log('❌ Login fallido:', pm.response.status);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"admin@nutritrack.com\",\n  \"password\": \"Admin123!\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/auth/login",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "auth", "login"]
						},
						"description": "Inicia sesión con el usuario administrador creado automáticamente al arrancar la aplicación.\n\n**Credenciales:**\n- Email: admin@nutritrack.com\n- Password: Admin123!\n\n**Post-script:** Guarda automáticamente el token en `adminToken`"
					},
					"response": []
				},
				{
					"name": "Registrar Usuario",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    var jsonData = pm.response.json();",
									"    if (jsonData.data && jsonData.data.token) {",
									"        pm.collectionVariables.set('userToken', jsonData.data.token);",
									"        console.log('✅ User token guardado:', jsonData.data.token);",
									"    }",
									"} else {",
									"    console.log('❌ Registro fallido:', pm.response.status);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"nombre\": \"Carlos\",\n  \"apellido\": \"Martínez\",\n  \"email\": \"carlos.martinez@email.com\",\n  \"password\": \"MiPassword123!\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/auth/registro",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "auth", "registro"]
						},
						"description": "Crea una nueva cuenta de usuario.\n\n**Reglas de negocio:**\n- RN01: Email debe ser único\n- RN02: Password debe cumplir requisitos mínimos\n\n**Post-script:** Guarda automáticamente el token en `userToken`"
					},
					"response": []
				},
				{
					"name": "Login Usuario",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    var jsonData = pm.response.json();",
									"    if (jsonData.data && jsonData.data.token) {",
									"        pm.collectionVariables.set('userToken', jsonData.data.token);",
									"        console.log('✅ User token guardado:', jsonData.data.token);",
									"    }",
									"} else {",
									"    console.log('❌ Login fallido:', pm.response.status);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"carlos.martinez@email.com\",\n  \"password\": \"MiPassword123!\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/auth/login",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "auth", "login"]
						},
						"description": "Inicia sesión con un usuario regular.\n\n**Reglas de negocio:**\n- RN02: Credenciales deben ser correctas\n- RN02: Cuenta debe estar activa\n\n**Post-script:** Guarda automáticamente el token en `userToken`"
					},
					"response": []
				},
				{
					"name": "Eliminar Cuenta",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    pm.collectionVariables.set('userToken', '');",
									"    console.log('✅ Cuenta eliminada y token limpiado');",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"confirmacion\": \"ELIMINAR\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/auth/cuenta",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "auth", "cuenta"]
						},
						"description": "Elimina permanentemente la cuenta del usuario autenticado.\n\n**Reglas de negocio:**\n- RN05: Requiere confirmación explícita escribiendo \"ELIMINAR\"\n- Requiere token válido\n\n**Post-script:** Limpia el token de la variable"
					},
					"response": []
				}
			]
		},
		{
			"name": "2. Gestión de Perfil",
			"description": "Endpoints para gestionar el perfil del usuario autenticado",
			"item": [
				{
					"name": "Obtener Mi Perfil",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/v1/perfil",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "perfil"]
						},
						"description": "Obtiene la información completa del perfil del usuario autenticado.\n\n**Respuesta incluye:**\n- Datos básicos (nombre, apellido, email)\n- Unidades de medida preferidas\n- Configuración de perfil de salud\n- Historial de medidas"
					},
					"response": []
				},
				{
					"name": "Actualizar Mi Perfil",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"nombre\": \"Carlos Alberto\",\n  \"apellido\": \"Martínez López\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/perfil",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "perfil"]
						},
						"description": "Actualiza los datos básicos del perfil del usuario.\n\n**Campos actualizables:**\n- nombre\n- apellido"
					},
					"response": []
				},
				{
					"name": "Actualizar Unidades de Medida",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"unidadesMedida\": \"KG\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/perfil/unidades",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "perfil", "unidades"]
						},
						"description": "Actualiza las unidades de medida preferidas del usuario.\n\n**Valores permitidos:**\n- `KG` - Kilogramos y centímetros (métrico)\n- `LBS` - Libras y pulgadas (imperial)\n\n**RN03:** Solo acepta KG o LBS"
					},
					"response": []
				}
			]
		},
		{
			"name": "3. Perfil de Salud",
			"description": "Configuración de objetivos y nivel de actividad física",
			"item": [
				{
					"name": "Configurar Perfil de Salud",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"objetivo\": \"PERDER_PESO\",\n  \"nivelActividad\": \"MODERADO\",\n  \"diasEntrenamiento\": [1, 3, 5]\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/perfil/salud",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "perfil", "salud"]
						},
						"description": "Crea o actualiza la configuración de salud del usuario.\n\n**Objetivo (ENUM):**\n- PERDER_PESO\n- MANTENER_PESO\n- GANAR_MASA_MUSCULAR\n\n**Nivel de actividad (ENUM):**\n- SEDENTARIO\n- LIGERO\n- MODERADO\n- ACTIVO\n- MUY_ACTIVO\n\n**Días de entrenamiento:**\n- Array de números del 1 al 7 (lunes=1, domingo=7)"
					},
					"response": []
				},
				{
					"name": "Obtener Perfil de Salud",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/v1/perfil/salud",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "perfil", "salud"]
						},
						"description": "Obtiene la configuración de salud actual del usuario.\n\n**Respuesta incluye:**\n- Objetivo fitness\n- Nivel de actividad física\n- Días de entrenamiento programados"
					},
					"response": []
				}
			]
		},
		{
			"name": "4. Historial de Medidas",
			"description": "Registro y seguimiento de medidas corporales",
			"item": [
				{
					"name": "Registrar Medidas",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"peso\": 75.5,\n  \"altura\": 175.0,\n  \"fecha\": \"2025-11-04\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/perfil/medidas",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "perfil", "medidas"]
						},
						"description": "Registra nuevas medidas corporales del usuario.\n\n**Campos:**\n- peso: En kg o lbs según configuración\n- altura: En cm o pulgadas según configuración\n- fecha: Formato ISO (YYYY-MM-DD)\n\n**RN04:** No puede registrar medidas futuras"
					},
					"response": []
				},
				{
					"name": "Obtener Historial de Medidas",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/v1/perfil/medidas",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "perfil", "medidas"]
						},
						"description": "Obtiene todo el historial de medidas del usuario ordenado por fecha descendente.\n\n**Respuesta incluye:**\n- Lista de medidas con peso, altura y fecha\n- IMC calculado automáticamente\n- Ordenado de más reciente a más antiguo"
					},
					"response": []
				},
				{
					"name": "Obtener Última Medida",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/v1/perfil/medidas/ultima",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "perfil", "medidas", "ultima"]
						},
						"description": "Obtiene la medida más reciente del usuario.\n\n**Útil para:**\n- Dashboard principal\n- Verificar progreso rápido\n- Formularios pre-rellenados"
					},
					"response": []
				}
			]
		},
		{
			"name": "5. Health Check",
			"description": "Verificación de estado del servidor",
			"item": [
				{
					"name": "Health Check",
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/health",
							"host": ["{{baseUrl}}"],
							"path": ["api", "health"]
						},
						"description": "Verifica que el servidor esté funcionando correctamente.\n\n**Respuesta esperada:**\n- Status: UP\n- Timestamp\n- Sin autenticación requerida"
					},
					"response": []
				}
			]
		}
	]
}
