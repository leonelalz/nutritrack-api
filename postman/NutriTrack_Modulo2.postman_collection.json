{
	"info": {
		"_postman_id": "nutritrack-modulo2-v1",
		"name": "NutriTrack API - Módulo 2",
		"description": "Colección de pruebas para Módulo 2: Gestión de Perfil de Salud y Mediciones\n\n**Funcionalidades implementadas:**\n- Crear perfil de salud (primera vez)\n- Actualizar perfil de salud\n- Consultar perfil de salud\n- Registrar mediciones corporales\n- Consultar historial de mediciones\n- Actualizar mediciones\n- Eliminar mediciones\n\n**Variables automáticas:**\n- `demoToken` - Token del usuario demo (demo@nutritrack.com)\n- `adminToken` - Token del usuario admin (admin@nutritrack.com)\n- `medicionId` - ID de la última medición creada\n\n**Credenciales de prueba:**\n- Demo: demo@nutritrack.com / Demo123!\n- Admin: admin@nutritrack.com / Admin123!\n\n**Base URL:** http://localhost:8081\n\n**Preparado por:** Fabián Rojas Pizarro - Noviembre 2025",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "nutritrack-modulo2"
	},
	"auth": {
		"type": "bearer",
		"bearer": [
			{
				"key": "token",
				"value": "{{demoToken}}",
				"type": "string"
			}
		]
	},
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:8081",
			"type": "string"
		},
		{
			"key": "demoToken",
			"value": "",
			"type": "string"
		},
		{
			"key": "adminToken",
			"value": "",
			"type": "string"
		},
		{
			"key": "medicionId",
			"value": "",
			"type": "string"
		}
	],
	"item": [
		{
			"name": "0. Autenticación",
			"description": "Obtener tokens JWT para las pruebas",
			"item": [
				{
					"name": "Login Demo User",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    var jsonData = pm.response.json();",
									"    if (jsonData.data && jsonData.data.token) {",
									"        pm.collectionVariables.set('demoToken', jsonData.data.token);",
									"        console.log('✅ Demo token guardado');",
									"        console.log('User ID:', jsonData.data.userId);",
									"        console.log('Perfil ID:', jsonData.data.perfilId);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"demo@nutritrack.com\",\n  \"password\": \"Demo123!\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/auth/login",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "auth", "login"]
						},
						"description": "**Usuario Demo:**\n- Email: demo@nutritrack.com\n- Password: Demo123!\n- Rol: ROLE_USER\n- Objetivo: PERDER_PESO\n- Actividad: MODERADO\n- Mediciones: 11 registros\n- Progreso: -5.5 kg (78.0 → 72.5 kg)"
					},
					"response": []
				},
				{
					"name": "Login Admin User",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    var jsonData = pm.response.json();",
									"    if (jsonData.data && jsonData.data.token) {",
									"        pm.collectionVariables.set('adminToken', jsonData.data.token);",
									"        console.log('✅ Admin token guardado');",
									"        console.log('User ID:', jsonData.data.userId);",
									"        console.log('Perfil ID:', jsonData.data.perfilId);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"admin@nutritrack.com\",\n  \"password\": \"Admin123!\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/auth/login",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "auth", "login"]
						},
						"description": "**Usuario Admin:**\n- Email: admin@nutritrack.com\n- Password: Admin123!\n- Rol: ROLE_ADMIN\n- Objetivo: MANTENER_FORMA\n- Actividad: ALTO\n- Mediciones: 11 registros\n- Peso estable: 70.0 → 70.5 kg"
					},
					"response": []
				}
			]
		},
		{
			"name": "1. Perfil de Salud",
			"description": "US-04 y US-06: Crear, actualizar y consultar perfil de salud",
			"item": [
				{
					"name": "Obtener Perfil de Salud",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/v1/perfil/salud",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "perfil", "salud"]
						},
						"description": "**US-06:** Consultar datos de salud\n\n**Respuesta esperada (Demo):**\n```json\n{\n  \"success\": true,\n  \"message\": \"Perfil de salud obtenido exitosamente\",\n  \"data\": {\n    \"objetivoActual\": \"PERDER_PESO\",\n    \"nivelActividadActual\": \"MODERADO\",\n    \"fechaActualizacion\": \"2025-11-04\"\n  }\n}\n```\n\n**Validaciones:**\n- ✅ Token JWT válido requerido\n- ✅ Retorna perfil existente del usuario\n- ✅ HTTP 200 OK"
					},
					"response": []
				},
				{
					"name": "Crear Perfil de Salud (Primera Vez)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"objetivoActual\": \"GANAR_MASA_MUSCULAR\",\n  \"nivelActividadActual\": \"ALTO\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/perfil/salud",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "perfil", "salud"]
						},
						"description": "**US-04:** Crear perfil de salud por primera vez\n\n**Nota:** Solo usar con usuario nuevo sin perfil.\n\n**Objetivos válidos:**\n- PERDER_PESO\n- GANAR_MASA_MUSCULAR\n- MANTENER_FORMA\n- REHABILITACION\n- CONTROLAR_ESTRES\n\n**Niveles de actividad válidos:**\n- BAJO (Sedentario)\n- MODERADO (3-4 días/semana)\n- ALTO (5-6 días/semana)\n\n**Validaciones:**\n- ✅ Token JWT requerido\n- ✅ Usuario sin perfil previo\n- ✅ Valores de enum válidos"
					},
					"response": []
				},
				{
					"name": "Actualizar Perfil de Salud",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"objetivoActual\": \"GANAR_MASA_MUSCULAR\",\n  \"nivelActividadActual\": \"ALTO\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/perfil/salud",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "perfil", "salud"]
						},
						"description": "**US-04:** Actualizar perfil de salud existente\n\n**Ejemplo de cambio:**\n- De PERDER_PESO a GANAR_MASA_MUSCULAR\n- De MODERADO a ALTO\n\n**Respuesta esperada:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Perfil de salud actualizado exitosamente\",\n  \"data\": {\n    \"objetivoActual\": \"GANAR_MASA_MUSCULAR\",\n    \"nivelActividadActual\": \"ALTO\",\n    \"fechaActualizacion\": \"2025-11-04\"\n  }\n}\n```\n\n**Validaciones:**\n- ✅ HTTP 200 OK\n- ✅ fechaActualizacion se actualiza\n- ✅ Cambios persisten en BD"
					},
					"response": []
				},
				{
					"name": "Actualizar a MANTENER_FORMA",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"objetivoActual\": \"MANTENER_FORMA\",\n  \"nivelActividadActual\": \"MODERADO\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/perfil/salud",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "perfil", "salud"]
						},
						"description": "Ejemplo adicional: Cambiar objetivo a mantenimiento con actividad moderada."
					},
					"response": []
				}
			]
		},
		{
			"name": "2. Historial de Mediciones",
			"description": "US-24: Registrar, consultar, actualizar y eliminar mediciones",
			"item": [
				{
					"name": "Obtener Historial Completo",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/v1/perfil/mediciones",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "perfil", "mediciones"]
						},
						"description": "**US-24:** Consultar historial de mediciones\n\n**Respuesta esperada (Demo - 11 mediciones):**\n```json\n{\n  \"success\": true,\n  \"message\": \"Historial obtenido\",\n  \"data\": [\n    {\n      \"id\": 12,\n      \"fechaMedicion\": \"2025-11-04\",\n      \"peso\": 72.5,\n      \"altura\": 168,\n      \"imc\": 25.7,\n      \"clasificacionIMC\": \"Peso normal\"\n    },\n    ...\n  ]\n}\n```\n\n**Validaciones:**\n- ✅ Ordenado por fecha DESC (más reciente primero)\n- ✅ Usuario Demo: 11 mediciones\n- ✅ Usuario Admin: 11 mediciones\n- ✅ IMC calculado automáticamente\n- ✅ Clasificación IMC correcta"
					},
					"response": []
				},
				{
					"name": "Obtener Medición por ID",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/v1/perfil/mediciones/12",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "perfil", "mediciones", "12"]
						},
						"description": "**US-24:** Obtener medición específica por ID\n\n**Nota:** Cambiar el ID (12) por uno válido de tu historial.\n\n**Respuesta esperada:**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"id\": 12,\n    \"fechaMedicion\": \"2025-11-04\",\n    \"peso\": 72.5,\n    \"altura\": 168,\n    \"imc\": 25.7\n  }\n}\n```\n\n**Validaciones:**\n- ✅ HTTP 200 si existe\n- ✅ HTTP 404 si no existe\n- ✅ Solo del usuario autenticado"
					},
					"response": []
				},
				{
					"name": "Registrar Nueva Medición",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    var jsonData = pm.response.json();",
									"    if (jsonData.data && jsonData.data.id) {",
									"        pm.collectionVariables.set('medicionId', jsonData.data.id);",
									"        console.log('✅ Medición ID guardada:', jsonData.data.id);",
									"        console.log('IMC calculado:', jsonData.data.imc);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"fechaMedicion\": \"2025-11-05\",\n  \"peso\": 72.0,\n  \"altura\": 168\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/perfil/mediciones",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "perfil", "mediciones"]
						},
						"description": "**US-24:** Registrar nueva medición corporal\n\n**Campos:**\n- fechaMedicion: Formato YYYY-MM-DD\n- peso: En kilogramos (20-300 kg)\n- altura: En centímetros (50-250 cm)\n\n**Cálculo automático:**\n- IMC = peso / (altura/100)²\n- Clasificación según OMS\n\n**Ejemplo:**\n- 72.0 kg / (1.68 m)² = 25.5 (Peso normal)\n\n**Validaciones:**\n- ✅ Fecha no puede ser futura\n- ✅ No duplicar fecha existente\n- ✅ Rangos de peso y altura válidos\n- ✅ HTTP 200 OK\n\n**Post-script:** Guarda ID en variable `medicionId`"
					},
					"response": []
				},
				{
					"name": "Actualizar Medición",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"peso\": 71.8,\n  \"altura\": 168\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/perfil/mediciones/{{medicionId}}",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "perfil", "mediciones", "{{medicionId}}"]
						},
						"description": "**US-24:** Actualizar medición existente\n\n**Uso:** Corregir errores en mediciones previas\n\n**Campos actualizables:**\n- peso\n- altura\n\n**No actualizable:**\n- fechaMedicion (se mantiene original)\n- id (inmutable)\n\n**IMC recalculado:**\n- 71.8 / (1.68)² = 25.4\n\n**Validaciones:**\n- ✅ ID debe existir\n- ✅ Solo del usuario autenticado\n- ✅ Rangos válidos\n- ✅ IMC se recalcula automáticamente"
					},
					"response": []
				},
				{
					"name": "Eliminar Medición",
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/v1/perfil/mediciones/{{medicionId}}",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "perfil", "mediciones", "{{medicionId}}"]
						},
						"description": "**US-24:** Eliminar medición del historial\n\n**Respuesta esperada:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Medición eliminada exitosamente\",\n  \"data\": null\n}\n```\n\n**Validaciones:**\n- ✅ HTTP 200 OK\n- ✅ Medición eliminada de BD\n- ✅ No aparece en GET /mediciones\n- ✅ Solo del usuario autenticado\n\n**Nota:** Usar con precaución, es permanente."
					},
					"response": []
				}
			]
		},
		{
			"name": "3. Casos de Error",
			"description": "Validar manejo de errores y reglas de negocio",
			"item": [
				{
					"name": "ERROR - Sin Autenticación",
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/v1/perfil/salud",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "perfil", "salud"]
						},
						"description": "**Validar:** Acceso denegado sin token JWT\n\n**Respuesta esperada:**\n```json\n{\n  \"success\": false,\n  \"message\": \"Token JWT requerido\"\n}\n```\n\n**HTTP Status:** 401 Unauthorized"
					},
					"response": []
				},
				{
					"name": "ERROR - Objetivo Inválido",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"objetivoActual\": \"OBJETIVO_INVENTADO\",\n  \"nivelActividadActual\": \"ALTO\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/perfil/salud",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "perfil", "salud"]
						},
						"description": "**Validar:** Enum de objetivo inválido\n\n**Respuesta esperada:**\n```json\n{\n  \"success\": false,\n  \"message\": \"Objetivo inválido. Valores permitidos: PERDER_PESO, GANAR_MASA_MUSCULAR, MANTENER_FORMA, REHABILITACION, CONTROLAR_ESTRES\"\n}\n```\n\n**HTTP Status:** 400 Bad Request"
					},
					"response": []
				},
				{
					"name": "ERROR - Fecha Duplicada",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"fechaMedicion\": \"2025-11-04\",\n  \"peso\": 70.0,\n  \"altura\": 168\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/perfil/mediciones",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "perfil", "mediciones"]
						},
						"description": "**Validar:** No se puede duplicar fecha de medición\n\n**Nota:** Usuario Demo ya tiene medición del 2025-11-04\n\n**Respuesta esperada:**\n```json\n{\n  \"success\": false,\n  \"message\": \"Ya existe una medición para la fecha 2025-11-04\"\n}\n```\n\n**HTTP Status:** 400 Bad Request"
					},
					"response": []
				},
				{
					"name": "ERROR - Medición No Encontrada",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/v1/perfil/mediciones/99999",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "perfil", "mediciones", "99999"]
						},
						"description": "**Validar:** ID inexistente retorna 404\n\n**Respuesta esperada:**\n```json\n{\n  \"success\": false,\n  \"message\": \"Medición no encontrada con ID: 99999\"\n}\n```\n\n**HTTP Status:** 404 Not Found"
					},
					"response": []
				},
				{
					"name": "ERROR - Peso Fuera de Rango",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"fechaMedicion\": \"2025-11-06\",\n  \"peso\": 10.0,\n  \"altura\": 168\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/perfil/mediciones",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "perfil", "mediciones"]
						},
						"description": "**Validar:** Peso debe estar entre 20-300 kg\n\n**Respuesta esperada:**\n```json\n{\n  \"success\": false,\n  \"message\": \"El peso debe estar entre 20 y 300 kg\"\n}\n```\n\n**HTTP Status:** 400 Bad Request"
					},
					"response": []
				}
			]
		},
		{
			"name": "4. Verificación de Datos",
			"description": "Endpoints para verificar datos precargados",
			"item": [
				{
					"name": "Verificar Datos Demo User",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/v1/perfil/mediciones",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "perfil", "mediciones"]
						},
						"description": "**Verificar datos precargados del usuario Demo:**\n\n**Esperado:**\n- 11 mediciones totales\n- Fecha más antigua: 2025-09-01\n- Fecha más reciente: 2025-11-04\n- Peso inicial: 78.0 kg\n- Peso actual: 72.5 kg\n- Progreso: -5.5 kg\n- Altura constante: 168 cm\n- IMC inicial: 27.6 (Sobrepeso)\n- IMC actual: 25.7 (Peso normal)\n\n**Token:** Usar `demoToken`"
					},
					"response": []
				},
				{
					"name": "Verificar Datos Admin User",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{adminToken}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/v1/perfil/mediciones",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "perfil", "mediciones"]
						},
						"description": "**Verificar datos precargados del usuario Admin:**\n\n**Esperado:**\n- 11 mediciones totales\n- Fecha más antigua: 2025-09-01\n- Fecha más reciente: 2025-11-04\n- Peso inicial: 70.0 kg\n- Peso actual: 70.5 kg\n- Progreso: +0.5 kg (estable)\n- Altura constante: 175 cm\n- IMC: ~23.0 (Peso normal)\n\n**Token:** Usar `adminToken`"
					},
					"response": []
				},
				{
					"name": "Comparar Perfil Demo vs Admin",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/v1/perfil/salud",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "perfil", "salud"]
						},
						"description": "**Ejecutar dos veces:**\n\n**1. Con demoToken:**\n- Objetivo: PERDER_PESO\n- Actividad: MODERADO\n\n**2. Con adminToken:**\n- Objetivo: MANTENER_FORMA\n- Actividad: ALTO\n\n**Comparar** las diferencias entre ambos perfiles."
					},
					"response": []
				}
			]
		},
		{
			"name": "5. Health Check",
			"description": "Verificación de estado del servidor",
			"item": [
				{
					"name": "Health Check",
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/health",
							"host": ["{{baseUrl}}"],
							"path": ["api", "health"]
						},
						"description": "**Verificar** que el servidor esté funcionando.\n\n**Respuesta esperada:**\n```json\n{\n  \"status\": \"UP\",\n  \"timestamp\": \"2025-11-04T20:00:00\"\n}\n```\n\n**Sin autenticación requerida**"
					},
					"response": []
				}
			]
		}
	]
}
